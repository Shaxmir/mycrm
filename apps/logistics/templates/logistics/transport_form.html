{% extends 'base.html' %}
{% block content %}
<h2>Добавление перевозки</h2>
<form method="post">
    {% csrf_token %}
    {{ form.as_p }}

    <label for="category-select">Выберите категорию:</label>
    <select id="category-select">
        <option value="">-- выберите --</option>
        {% for category in categories %}
            <option value="{{ category.id }}">{{ category.name }}</option>
        {% endfor %}
    </select>

    <div id="product-container">
        <!-- Здесь будут показываться товары выбранной категории -->
    </div>

    <button type="submit">Сохранить</button>
</form>

<script>
    const categorySelect = document.getElementById('category-select');
    const productContainer = document.getElementById('product-container');

    const productsByCategory = {
        {% for category in categories %}
            "{{ category.id }}": [
                {% for product in category.products.all %}
                    {
                        id: "{{ product.id }}",
                        name: "{{ product.name }}"
                    },
                {% endfor %}
            ],
        {% endfor %}
    };

    categorySelect.addEventListener('change', function () {
        const categoryId = this.value;
        productContainer.innerHTML = '';

        if (productsByCategory[categoryId]) {
            productsByCategory[categoryId].forEach(product => {
                const div = document.createElement('div');
                div.innerHTML = `
                    <label>${product.name}</label>
                    <input type="number" name="product_${product.id}" value="0" min="0">
                `;
                productContainer.appendChild(div);
            });
        }
    });
</script>
{% endblock %}
