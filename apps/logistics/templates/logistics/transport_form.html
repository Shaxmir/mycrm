{% extends 'base.html' %}
{% load static %}
{% block content %}
<h2>Добавить транспорт</h2>

<form method="post">
    {% csrf_token %}
    <label for="id_type">Тип:</label>
    {{ form.type }}

    <label for="id_warehouse">Склад:</label>
    {{ form.warehouse }}

    <hr>

    <div id="products-container">
        <div class="product-form">
            <label>Товар:</label>
            <select name="product">
                {% for category in categories %}
                    <optgroup label="--- {{ category.name }} ---">
                        {% for product in category.products.all %}
                            <option value="{{ product.id }}">
                                {{ product.name }}
                                {% if product.thickness %}{{ product.thickness }} мм{% endif %}
                                {% if product.format %} {{ product.format }}{% endif %}
                                {% if product.grade %} {{ product.grade }}{% endif %}
                                {% if product.surface %} {{ product.surface }}{% endif %}
                                {% if product.unit %} {{ product.unit }}{% endif %}
                            </option>
                        {% endfor %}
                    </optgroup>
                {% endfor %}
            </select>
            <label>Количество:</label>
            <input type="number" name="quantity" min="1" required>
        </div>
    </div>

    <button type="button" id="add-product">Добавить товар</button>
    <br><br>
    <button type="submit">Сохранить</button>
</form>

<script>
document.getElementById('add-product').addEventListener('click', function () {
    const container = document.getElementById('products-container');
    const newBlock = container.children[0].cloneNode(true);
    newBlock.querySelectorAll('input').forEach(input => input.value = '');
    container.appendChild(newBlock);
});
</script>
{% endblock %}
